<!DOCTYPE html>

{% extends 'base_build.html' %}
{% block content %}
<div class="list-wrapper">
    <div id="left" class="list">
        <div id="Washington" class="object noSelect">Washington</div>
        <div id="Texas" class="object noSelect">Texas</div>
        <div id="Idaho" class="object noSelect">Idaho</div>
        <div id="Michigan" class="object noSelect">Michigan</div>
    </div>
    <div id="center" class="list">
        <div id="Georgia" class="object noSelect">Georgia</div>
        <div id="Tennessee" class="object noSelect">Tennessee</div>
        <div id="Alabama" class="object noSelect">Alabama</div>
    </div>
    <div id="right" class="list">
        <div id="Indiana" class="object noSelect">Indiana</div>
        <div id="Colorado" class="object noSelect">Colorado</div>
        <div id="Wisconsin" class="object noSelect">Wisconsin</div>
    </div>
</div>
<div>
    <button id="submit">Submit</button>
</div>
<script>
    function handleSubmit() {
        const pwl = generatePairwise()
        sendPostRequest(pwl)
    }
    function generatePairwise() {
        const high = Array.from(document.querySelectorAll('#left .object')).map(x => x.id)
        const med = Array.from(document.querySelectorAll('#center .object')).map(x => x.id)
        const low = Array.from(document.querySelectorAll('#right .object')).map(x => x.id)
        // pairwise list to send back to server
        let pwl = []
        for (let i = 0; i < high.length; i++) {
            for (let j = 0; j < med.length; j++) {
                pwl.push({ 'high': high[i], 'low': med[j] })
            }
            for (let j = 0; j < low.length; j++) {
                pwl.push({ 'high': high[i], 'low': low[j] })
            }
        }
        for (let i = 0; i < med.length; i++) {
            for (let j = 0; j < low.length; j++) {
                pwl.push({ 'high': med[i], 'low': low[j] })
            }
        }
        console.log(pwl)
        return pwl
    }
    function sendPostRequest(pwl) {
        const dataset_name = '{{dataset_name}}'
        const url = '/build/submit/'
        const xhr = new XMLHttpRequest()
        xhr.open('POST', url, true)
        xhr.setRequestHeader('Content-type', 'application/json')
        // xhr.onload()
        xhr.send(JSON.stringify({
            dataset_name: dataset_name,
            pairs: pwl
        }))
        xhr.onload = function () {
            document.write(this.response)
        }
    }
    document.querySelector('#submit').addEventListener('click', handleSubmit)
</script>
{% endblock %}
