<!DOCTYPE html>

{% extends 'base_build.html' %}
{% block content %}
<style>
  .pairwise {
    display: grid;
    grid-template-areas: "_ high low";
    grid-template-columns: 1fr 1fr 1fr 1fr;
  }
  .high {
    grid-area: high;
    /* border: 5px solid #E74C3C; */
    padding: 8px;
    /* display:inline; */
  }
  .low {
    grid-area: low;
    /* border: 5px solid #E74C3C; */
    padding: 8px;
    /* display:inline; */
  }
  .pw-wrapper {
    display: grid;
    grid-template-areas: "_ pwl  pwl"
                         "_ more more";
    grid-template-columns: 1fr 1fr 1fr 1fr;
  }
  #pwl {
    grid-area: pwl;
  }
  .pw {
    display: grid;
    grid-template-areas: "high low";
    grid-template-columns: 1fr 1fr;
    border: 5px solid #E74C3C;
    margin: 16px;
  }
  #more {
    grid-area: more;
    padding: 12px;
    margin-bottom: 48px;
  }

</style>

<div class="pw-wrapper">
  <div id="pwl">
    <div class="pw">
      <div class="high"></div>
      <div class="low"></div>
    </div>
  </div>
  <button type="button" class="btn " id="more" onclick="handleMore()">Add New Pairwise</button>
  
  <!-- <div class="pairwise">
    <div class="list high">
      <h2><b> High </b></h2>
      <div id="bot"  class="list">
        <div id="high" class="list"></div>
      </div>
    </div>
    <div class="list low">
      <h2><b> Low </b></h2>
      <div id="bot"  class="list">
        <div id="low" class="list"></div>
      </div>
    </div>
    
  </div> -->
</div>
<!-- <button type="button" class="semi-transparent-button btn " id="sort" onclick="">+</button> -->

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.6.1/Sortable.min.js"></script>
<script type = "text/javascript" src = "{{ url_for('static', filename = 'js/pwc.js') }}" ></script>
<!-- <script type = "text/javascript" src="{{ url_for('static', filename = 'js/dragula.min.js') }}"></script> -->

<script>



    var min_num_of_objects = 2

    var observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
            const high_length = document.querySelectorAll('.high > div').length
            const low_length = document.querySelectorAll('.low > div').length

            const list_num = (high_length > 0 ? 1 : 0) + (low_length > 0 ? 1 : 0)

            if ((high_length != low_length) ||  ( list_num < min_num_of_objects)){
                $('#submit').attr('disabled', 'disabled');
            }
            else {
                $('#submit').removeAttr('disabled');
            }
        });
    });

    // Node, config
    var observerConfig = {
        childList: true,
        subtree: true,
    };

    var node = document.getElementById('pwl');
    observer.observe(node, observerConfig);

    function getRankedObjects(){
        return []
    }
  function handleSubmit() {
    const pwl = generatePairwise()
    sendPostRequest(pwl)
  }
  function generatePairwise() {
    const highs = Array.from(document.querySelectorAll('.high .object')).map(x => x.id)
    const lows = Array.from(document.querySelectorAll('.low .object')).map(x => x.id)

    let pwl = []
    for (let i = 0; i < highs.length; i++) {
      pwl.push({ 'high': highs[i], 'low': lows[i] })
    }
    console.log(pwl)
    return pwl
  }
  function sendPostRequest(pwl) {
    const dataset_name = '{{dataset_name}}'
    const url = '/build/submit/'
    const xhr = new XMLHttpRequest()
    xhr.open('POST', url, true)
    xhr.setRequestHeader('Content-type', 'application/json')
    // xhr.onload()
    xhr.send(JSON.stringify({
      dataset_name: dataset_name,
      pairs: pwl
    }))
    xhr.onload = function () {
      document.write(this.response)
    }
  }
  document.querySelector('#submit').addEventListener('click', handleSubmit)
</script>

{% endblock %}
